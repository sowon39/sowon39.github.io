<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"/>
  <title>DK MASTER OS v11.3</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Pretendard:wght@400;600;800;900&display=swap');

    :root{
      --primary:#22d3ee;
      --accent:#6366f1;
      --bg:#050507;
      --card:rgba(255,255,255,0.04);

      /* âœ… dock dynamic space */
      --dock-space: 92px;
      --dock-radius: 28px;
    }

    html,body{ height:100%; }

    body{
      font-family:'Pretendard',sans-serif;
      background-color:var(--bg);
      color:#e4e4e7;
      margin:0;
      overflow-x:hidden;

      /* âœ… Dockê°€ ë– ë„ ë³¸ë¬¸ì´ ì ˆëŒ€ ê°€ë ¤ì§€ì§€ ì•Šê²Œ ê³µê°„ í™•ë³´(ë™ì  ì—…ë°ì´íŠ¸) */
      padding-bottom: calc(var(--dock-space) + env(safe-area-inset-bottom));

      background-image:
        radial-gradient(1200px 700px at 15% -10%, rgba(34,211,238,0.18), transparent 55%),
        radial-gradient(1200px 700px at 100% 10%, rgba(99,102,241,0.22), transparent 55%),
        radial-gradient(900px 600px at 15% 110%, rgba(12,74,110,0.25), transparent 55%),
        linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.00));
      background-attachment: fixed;
    }

    ::-webkit-scrollbar{ display:none; }
    .scroll-hide{ -ms-overflow-style:none; scrollbar-width:none; }

    .glass{
      background:var(--card);
      backdrop-filter:blur(22px);
      -webkit-backdrop-filter:blur(22px);
      border:1px solid rgba(255,255,255,0.10);
    }

    /* Splash */
    #splash-screen{
      position:fixed; inset:0; z-index:10000;
      background:#000;
      display:flex; flex-direction:column; align-items:center; justify-content:center;
      transition:all 1s cubic-bezier(0.65,0,0.35,1);
    }
    .booting-sequence{ text-align:center; width:240px;}
    .intro-logo{
      font-size:6rem; font-weight:900; font-style:italic; line-height:1;
      background:linear-gradient(180deg,#fff 40%,var(--primary));
      -webkit-background-clip:text; -webkit-text-fill-color:transparent;
      letter-spacing:-0.08em; margin-bottom:2rem;
      filter:drop-shadow(0 0 15px rgba(34,211,238,0.3));
    }
    .scan-line{ width:100%; height:2px; border-radius:2px; background:rgba(34,211,238,0.2); position:relative; overflow:hidden; }
    .scan-bar{ position:absolute; width:40%; height:100%; background:var(--primary); box-shadow:0 0 10px var(--primary); animation:scan 1.5s infinite ease-in-out; }
    .auth-text{ margin-top:1rem; font-size:10px; font-weight:800; color:#444; letter-spacing:0.2em; text-transform:uppercase;}
    .auth-name{ color:var(--primary); opacity:0; animation:fadeIn 0.5s forwards 1.2s;}
    @keyframes scan{0%{left:-40%;}100%{left:100%;}}
    @keyframes fadeIn{from{opacity:0;}to{opacity:1;}}

    /* Header */
    header{
      position:fixed; top:0; left:0; right:0; z-index:50;
      padding: 18px 18px 14px;
      border-bottom:1px solid rgba(255,255,255,0.06);
      backdrop-filter: blur(18px);
      background: rgba(10,10,12,0.62);
    }

    .tab-content{ display:none; animation:fadeInContent 0.45s ease-out; }
    .tab-content.active{ display:block; }
    @keyframes fadeInContent{ from{opacity:0; transform:translateY(6px) scale(0.985);} to{opacity:1; transform:translateY(0) scale(1);} }

    /* Pills */
    .pill{
      display:inline-flex; align-items:center; gap:6px;
      padding:6px 10px; border-radius:999px;
      border:1px solid rgba(255,255,255,0.10);
      background:rgba(255,255,255,0.04);
      font-size:11px; font-weight:900;
      color:rgba(255,255,255,0.82);
      white-space:nowrap;
    }
    .pill.cyan{ border-color:rgba(34,211,238,0.25); background:rgba(34,211,238,0.10); color:rgba(34,211,238,0.95); }

    /* âœ… Carousel: banner + strong peek */
    .carousel{
      display:flex;
      gap:18px;
      overflow-x:auto;
      scroll-snap-type:x mandatory;
      -webkit-overflow-scrolling:touch;
      padding: 0 18px 16px;
      margin: 0 -18px;
    }
    .carousel::before,.carousel::after{ content:''; flex:0 0 10px; }

    .carousel > .slide{
      scroll-snap-align:center;
      flex: 0 0 92%;
      min-height: calc(100dvh - 260px);
      transition: opacity .22s ease, transform .22s ease, filter .22s ease;
    }
    .slide.peek{ opacity:.55; transform:scale(.92); filter:blur(1.2px); }
    .slide.focus{ opacity:1; transform:scale(1); filter:none; }

    @media (min-width: 860px){
      .carousel{ padding:0 10px 16px; margin:0; }
      .carousel::before,.carousel::after{ display:none; }
      .carousel > .slide{ flex:0 0 70%; min-height:auto; }
    }

    .slideCard{
      height:100%;
      display:flex;
      flex-direction:column;
      justify-content:space-between;
      border-radius:32px;
      box-shadow: 0 30px 80px rgba(0,0,0,0.55);
      transition: transform .22s ease, box-shadow .22s ease;
    }
    .slide.focus .slideCard{ box-shadow: 0 40px 90px rgba(0,0,0,0.65); }

    /* Right Panel */
    .rightPanel{ border-radius:26px; padding:18px; background:rgba(255,255,255,0.03); border:1px solid rgba(255,255,255,0.08); }

    .stepper{
      display:flex; gap:10px; align-items:center; justify-content:space-between;
      padding:14px 14px; border-radius:22px;
      background:rgba(255,255,255,0.04);
      border:1px solid rgba(255,255,255,0.10);
    }
    .stepperLabel{ font-size:10px; font-weight:900; letter-spacing:.18em; text-transform:uppercase; color:rgba(255,255,255,0.50); }
    .stepperValue{ font-size:22px; font-weight:950; color:white; }
    .stepperBtn{
      width:48px; height:48px; border-radius:18px;
      display:flex; align-items:center; justify-content:center;
      font-weight:900;
      background:rgba(255,255,255,0.05);
      border:1px solid rgba(255,255,255,0.12);
      color:rgba(255,255,255,0.9);
      -webkit-tap-highlight-color:transparent;
    }
    .stepperBtn:active{ transform:scale(.98); }

    .bigBtn{
      width:100%; height:60px; border-radius:20px;
      font-weight:900; font-size:15px;
      display:flex; align-items:center; justify-content:center; gap:10px;
      transition: transform .12s ease;
      -webkit-tap-highlight-color:transparent;
      user-select:none;
      background:rgba(255,255,255,0.05);
      border:1px solid rgba(255,255,255,0.10);
    }
    .bigBtn:active{ transform:scale(0.985); }

    .setBtn{
      width:100%; height:66px; border-radius:20px;
      font-weight:950; font-size:18px;
      display:flex; align-items:center; justify-content:center; gap:10px;
      transition: transform .12s ease;
      -webkit-tap-highlight-color:transparent;
      background:rgba(255,255,255,0.05);
      border:1px solid rgba(255,255,255,0.10);
    }
    .setBtn:active{ transform:scale(0.985); }
    .setBtn.done{ background:linear-gradient(135deg,var(--primary),var(--accent)); color:#000; box-shadow:0 18px 34px rgba(34,211,238,0.24); border:none; }

    /* âœ… Day quick nav (ìš”ì¼ ë„¤ë¹„) ë³µêµ¬ + Dockì™€ ì¶©ëŒ ë°©ì§€ */
    #day-nav-wrap{
      transition: all .35s ease;
      position: sticky;
      top: 86px;
      z-index: 20;
    }
    #day-nav-wrap.hide{ transform:translateY(18px); opacity:0; pointer-events:none; }
    .day-chip{
      width:44px; height:44px; border-radius:18px;
      display:flex; align-items:center; justify-content:center;
      font-weight:900; font-size:12px;
      color:rgba(255,255,255,0.55);
      border:1px solid rgba(255,255,255,0.10);
      background:rgba(10,10,12,0.45);
      backdrop-filter: blur(18px);
      flex:0 0 auto;
    }
    .day-chip.active{
      background:var(--primary); color:#000;
      border-color:rgba(34,211,238,0.25);
      box-shadow:0 10px 24px rgba(34,211,238,0.25);
    }

    /* âœ… Bottom Sheet Dock (mini + expanded) */
    .dockWrap{
      position:fixed;
      left:0; right:0; bottom:0;
      z-index:60;
      display:flex;
      justify-content:center;
      padding: 10px 16px calc(env(safe-area-inset-bottom) + 10px);
      transition: transform .35s cubic-bezier(.2,.9,.2,1), opacity .35s ease;
      pointer-events:none;
    }
    .dockWrap.hide{
      transform: translateY(120%);
      opacity: 0;
    }

    .dockSheet{
      pointer-events:auto;
      width:min(640px, calc(100vw - 34px));
      background:rgba(10,10,12,0.62);
      border:1px solid rgba(255,255,255,0.12);
      backdrop-filter: blur(24px);
      border-radius: var(--dock-radius);
      box-shadow:0 18px 45px rgba(0,0,0,0.65);
      overflow:hidden;
      position:relative;
      transform: translateY(0);
      transition: height .35s cubic-bezier(.2,.9,.2,1);
      height: 72px; /* mini */
      display:flex;
      flex-direction:column;
    }

    /* grabber */
    .dockGrab{
      height: 18px;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .dockGrab::before{
      content:'';
      width: 44px;
      height: 4px;
      border-radius: 999px;
      background: rgba(255,255,255,0.18);
    }

    /* expanded sheet */
    .dockSheet.expanded{
      height: 160px;
    }

    .nav-dock{
      padding: 8px 12px 14px;
      display:flex;
      justify-content:space-around;
      align-items:center;
    }
    .nav-item{
      position:relative;
      padding:10px 0;
      flex:1;
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:4px;
      transition:all .25s;
      color:#777;
      -webkit-tap-highlight-color:transparent;
    }
    .nav-item.active{ color:var(--primary); transform:translateY(-3px); }
    .nav-item i{ font-size:1.15rem; }
    .nav-active-dot{
      position:absolute; bottom:1px;
      width:4px; height:4px;
      background:var(--primary);
      border-radius:50%;
      box-shadow:0 0 12px var(--primary);
      opacity:0;
      transition:all .25s;
    }
    .nav-item.active .nav-active-dot{ opacity:1; transform:scale(1.6); }

    /* expanded quick actions */
    .dockActions{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
      padding: 0 12px 12px;
    }
    .dockActionBtn{
      height:44px;
      border-radius:16px;
      font-weight:950;
      font-size:12px;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      background: rgba(255,255,255,0.05);
      border:1px solid rgba(255,255,255,0.10);
      color: rgba(255,255,255,0.85);
      -webkit-tap-highlight-color:transparent;
    }
    .dockActionBtn:active{ transform:scale(.985); }

    /* Calendar */
    .calendar-day{ aspect-ratio:1; border-radius:16px; display:flex; align-items:center; justify-content:center; font-size:13px; position:relative; transition:all .18s; font-weight:800; color:rgba(255,255,255,0.75); background:rgba(255,255,255,0.03); border:1px solid rgba(255,255,255,0.06); }
    .calendar-day:hover{ background:rgba(255,255,255,0.07); }
    .has-log::after{ content:''; width:6px; height:6px; background:rgba(34,211,238,0.90); border-radius:50%; position:absolute; bottom:8px; box-shadow:0 0 12px rgba(34,211,238,0.35); }
    .calendar-day.selected{ background:rgba(34,211,238,0.14); border:1px solid rgba(34,211,238,0.35); box-shadow:0 0 0 2px rgba(34,211,238,0.18), 0 0 30px rgba(34,211,238,0.12); color:#eaffff; font-weight:900; transform:translateY(-2px); }
    .calendar-day.today{ border:1px solid rgba(255,255,255,0.12); box-shadow: inset 0 0 0 1px rgba(255,255,255,0.08); color:rgba(255,255,255,0.95); font-weight:900; }

    /* History table */
    .log-table{ width:100%; border-collapse:separate; border-spacing:0 10px; }
    .log-table th{ font-size:10px; text-transform:uppercase; letter-spacing:.18em; color:rgba(255,255,255,0.35); font-weight:900; text-align:left; padding:0 10px 6px; }
    .log-row{ background:rgba(255,255,255,0.03); border:1px solid rgba(255,255,255,0.06); border-radius:16px; overflow:hidden; }
    .log-row td{ padding:12px 10px; font-weight:800; font-size:12px; color:rgba(255,255,255,0.78); }

    /* Toast */
    #toast{ position:fixed; left:50%; bottom: calc(var(--dock-space) + 22px); transform:translateX(-50%); z-index:250; opacity:0; pointer-events:none; transition:opacity .25s, transform .25s; }
    #toast.show{ opacity:1; transform:translateX(-50%) translateY(-6px); }

    /* Summary modal */
    #summary-modal{ position:fixed; inset:0; z-index:220; display:none; align-items:center; justify-content:center; }
    #summary-modal.show{ display:flex; }

    /* âœ… Layout container: í™”ë©´ ì¢Œìš° ì—¬ë°± ë„‰ë„‰ + ë„“ê²Œ ì‚¬ìš© */
    .pageWrap{
      width:100%;
      margin:0 auto;
      padding-left:18px;
      padding-right:18px;
      max-width: 1120px;
    }
    @media (max-width: 520px){
      .pageWrap{
        padding-left:16px;
        padding-right:16px;
        max-width: none;
      }
    }
    @media (min-width: 1400px){
      .pageWrap{ max-width: 1240px; }
    }
  </style>
</head>

<body>

  <!-- Splash -->
  <div id="splash-screen">
    <div class="booting-sequence">
      <div class="intro-logo">DK</div>
      <div class="scan-line"><div class="scan-bar"></div></div>
      <div class="auth-text">Authorized Access: <span class="auth-name">GRANTED</span></div>
      <div class="text-[8px] text-gray-700 mt-12 font-mono uppercase tracking-[0.3em]">System v11.3 Loaded</div>
    </div>
  </div>

  <!-- Header -->
  <header>
    <div class="pageWrap flex justify-between items-end">
      <div>
        <h2 id="stopwatch" class="text-3xl font-black font-mono tracking-tighter text-white">00:00</h2>
        <div class="flex items-center gap-2 mt-1">
          <span class="w-1.5 h-1.5 rounded-full bg-green-500 animate-pulse"></span>
          <p class="text-[9px] font-black text-gray-300 tracking-widest uppercase">ì—˜ë¦¬íŠ¸ ëª¨ë“œ Â· DK</p>
        </div>
      </div>
      <div class="flex flex-col items-end">
        <span id="progress-percent" class="text-[10px] font-black mb-1.5 text-cyan-300">0%</span>
        <div class="w-28 h-1.5 bg-white/5 rounded-full overflow-hidden">
          <div id="progress-bar" class="h-full bg-cyan-400 shadow-[0_0_12px_#22d3ee] transition-all duration-700" style="width:0%"></div>
        </div>
      </div>
    </div>
  </header>

  <!-- Main -->
  <main class="pageWrap pt-28">

    <!-- âœ… ìš”ì¼ ë„¤ë¹„ê²Œì´ì…˜ (Sessionì—ì„œë§Œ ìë™ í‘œì‹œ) -->
    <div id="day-nav-wrap" class="hide mb-4">
      <div id="day-nav" class="flex justify-center gap-2 overflow-x-auto pb-2 scroll-hide"></div>
    </div>

    <!-- Session -->
    <section id="tab-session" class="tab-content active">
      <div class="mb-6 px-2 flex justify-between items-start">
        <div>
          <h1 id="view-day" class="text-5xl font-black italic text-white uppercase tracking-tighter">DAY</h1>
          <p id="view-title" class="text-gray-300 font-black mt-1 text-sm tracking-wide"></p>
          <p id="view-subcue" class="text-[10px] font-black text-white/50 mt-2 tracking-[0.18em] uppercase"></p>
        </div>
        <button onclick="resetToday()" class="pill" title="ì˜¤ëŠ˜ ê¸°ë¡ ì´ˆê¸°í™”">
          <i class="fa-solid fa-rotate-left"></i> ì˜¤ëŠ˜ ì´ˆê¸°í™”
        </button>
      </div>

      <div class="flex items-center justify-between px-2 mb-4">
        <div class="flex items-center gap-2">
          <span class="pill cyan" id="slide-indicator">1 / 1</span>
          <span class="pill" id="slide-name">ìš´ë™</span>
        </div>
        <div class="flex items-center gap-2">
          <button onclick="carouselPrev()" class="pill"><i class="fa-solid fa-chevron-left"></i></button>
          <button onclick="carouselNext()" class="pill"><i class="fa-solid fa-chevron-right"></i></button>
        </div>
      </div>

      <div id="session-carousel" class="carousel scroll-hide"></div>
    </section>

    <!-- Stats -->
    <section id="tab-stats" class="tab-content">
      <div class="mb-8 px-2"><h2 class="text-3xl font-black italic uppercase tracking-tight">ë¶„ì„</h2></div>
      <div class="glass rounded-[28px] p-8 mb-6"><canvas id="radarChart" class="max-h-[320px]"></canvas></div>
      <div class="grid grid-cols-2 gap-5">
        <div class="glass rounded-[28px] p-6">
          <p class="text-[9px] text-gray-400 font-black uppercase mb-2 tracking-widest">ì´ ê¸°ë¡(ì„¸íŠ¸)</p>
          <p id="stat-total-sets" class="text-4xl font-black text-white">0</p>
        </div>
        <div class="glass rounded-[28px] p-6">
          <p class="text-[9px] text-gray-400 font-black uppercase mb-2 tracking-widest">í™œë™ ì¼ìˆ˜</p>
          <p id="stat-week-count" class="text-4xl font-black text-indigo-300">0</p>
        </div>
      </div>

      <div class="mt-6 grid gap-3">
        <button onclick="backupJSON()" class="bigBtn"><i class="fa-solid fa-download"></i> ë°±ì—…(JSON)</button>
        <button onclick="resetAll()" class="bigBtn" style="border-color: rgba(255,255,255,0.18);"><i class="fa-solid fa-triangle-exclamation"></i> ì „ì²´ ì´ˆê¸°í™”</button>
      </div>
    </section>

    <!-- History -->
    <section id="tab-history" class="tab-content">
      <div class="mb-8 px-2 flex justify-between items-end">
        <h2 class="text-3xl font-black italic uppercase">ê¸°ë¡</h2>
        <div class="flex items-center gap-4 glass rounded-2xl px-5 py-2.5">
          <button onclick="changeMonth(-1)" class="p-1 hover:text-cyan-300 transition-colors"><i class="fa-solid fa-chevron-left text-xs"></i></button>
          <span id="calendar-month" class="text-xs font-black w-20 text-center tracking-widest">2026.01</span>
          <button onclick="changeMonth(1)" class="p-1 hover:text-cyan-300 transition-colors"><i class="fa-solid fa-chevron-right text-xs"></i></button>
        </div>
      </div>

      <div class="glass rounded-[28px] p-7 mb-6 shadow-2xl">
        <div class="grid grid-cols-7 text-center text-[9px] font-black text-gray-500 mb-5 uppercase tracking-[0.2em]">
          <div class="text-red-600">ì¼</div><div>ì›”</div><div>í™”</div><div>ìˆ˜</div><div>ëª©</div><div>ê¸ˆ</div><div class="text-blue-600">í† </div>
        </div>
        <div id="calendar-body" class="grid grid-cols-7 gap-3"></div>
      </div>

      <div class="flex gap-2 mb-4 px-2">
        <button onclick="resetSelectedDate()" class="pill"><i class="fa-solid fa-eraser"></i> ì„ íƒ ë‚ ì§œ ì´ˆê¸°í™”</button>
      </div>

      <div id="history-detail" class="space-y-6"></div>
    </section>

  </main>

  <!-- âœ… Bottom Sheet Dock -->
  <div id="dockWrap" class="dockWrap hide">
    <div id="dockSheet" class="dockSheet">
      <div class="dockGrab" id="dockGrab"></div>

      <nav class="nav-dock">
        <button onclick="showTab('session', this)" class="nav-item active">
          <i class="fa-solid fa-bolt-lightning"></i>
          <span class="text-[8px] font-black uppercase tracking-tighter">í›ˆë ¨</span>
          <div class="nav-active-dot"></div>
        </button>
        <button onclick="showTab('stats', this)" class="nav-item">
          <i class="fa-solid fa-chart-simple"></i>
          <span class="text-[8px] font-black uppercase tracking-tighter">ë¶„ì„</span>
          <div class="nav-active-dot"></div>
        </button>
        <button onclick="showTab('history', this)" class="nav-item">
          <i class="fa-solid fa-calendar-days"></i>
          <span class="text-[8px] font-black uppercase tracking-tighter">ê¸°ë¡</span>
          <div class="nav-active-dot"></div>
        </button>
      </nav>

      <div class="dockActions">
        <button class="dockActionBtn" onclick="resetToday()"><i class="fa-solid fa-rotate-left"></i> ì˜¤ëŠ˜ ì´ˆê¸°í™”</button>
        <button class="dockActionBtn" onclick="backupJSON()"><i class="fa-solid fa-download"></i> ë°±ì—…</button>
      </div>
    </div>
  </div>

  <!-- SUMMARY MODAL -->
  <div id="summary-modal">
    <div class="absolute inset-0 bg-black/85 backdrop-blur-xl" onclick="closeSummary()"></div>
    <div class="relative glass rounded-[28px] p-7 w-[min(520px,calc(100vw-44px))]">
      <div class="flex items-start justify-between gap-4">
        <div>
          <p class="text-[10px] font-black tracking-[0.2em] uppercase text-white/45">ì˜¤ëŠ˜ ìš”ì•½</p>
          <h3 class="text-2xl font-black italic text-white mt-1">ì™„ë£Œ ğŸ‰</h3>
        </div>
        <button class="pill" onclick="closeSummary()"><i class="fa-solid fa-xmark"></i></button>
      </div>

      <div class="mt-5 grid grid-cols-2 gap-3">
        <div class="glass rounded-2xl p-4">
          <p class="text-[9px] font-black tracking-[0.18em] uppercase text-white/40">ì™„ë£Œ ì„¸íŠ¸</p>
          <p id="sum-sets" class="text-3xl font-black text-white mt-2">0</p>
        </div>
        <div class="glass rounded-2xl p-4">
          <p class="text-[9px] font-black tracking-[0.18em] uppercase text-white/40">ì™„ë£Œ ìš´ë™</p>
          <p id="sum-ex" class="text-3xl font-black text-white mt-2">0</p>
        </div>
        <div class="glass rounded-2xl p-4 col-span-2">
          <p class="text-[9px] font-black tracking-[0.18em] uppercase text-white/40">ì˜¤ëŠ˜ í•œë§ˆë””</p>
          <p id="sum-msg" class="text-base font-black text-white/80 mt-2">ì¢‹ì€ í›ˆë ¨ì´ì—ˆìŠµë‹ˆë‹¤.</p>
        </div>
      </div>

      <div class="mt-6 flex gap-3">
        <button class="bigBtn" onclick="closeSummary()" style="background:linear-gradient(135deg,var(--primary),var(--accent)); color:#000; border:none;">
          <i class="fa-solid fa-check"></i> í™•ì¸
        </button>
        <button class="bigBtn" onclick="showTab('history', document.querySelectorAll('.nav-item')[2]); closeSummary();">ê¸°ë¡ ë³´ê¸°</button>
      </div>
    </div>
  </div>

  <!-- Toast -->
  <div id="toast" class="pill cyan"></div>

  <script>
    /* =========================================================
      DK MASTER OS v11.3 (UPDATED FINAL)
      - âœ… Dock: Bottom Sheet + Swipe Expand
      - âœ… Dock: content never covered (dynamic padding)
      - âœ… Day nav restored + fixed
      - âœ… Carousel: banner preview
    ========================================================= */

    /* ---------- DATA ---------- */
    const workoutData = {
      1: { day: "ì›”ìš”ì¼", type: "push", title: "ê°€ìŠ´ & ì‚¼ë‘", list: [
        { name: "ì²´ìŠ¤íŠ¸ ë”¥ìŠ¤", set: 4, rep: 10, rest: 90, breath: "ë‚´ë ¤ê°ˆ ë•Œ í¡ê¸° / ì˜¬ë¼ì˜¬ ë•Œ í˜¸ê¸°", target: "ê°€ìŠ´ í•˜ë¶€", mind: "ë°”ë‹¥ì„ ê°€ìŠ´ìœ¼ë¡œ ë°€ì–´ë‚´ê¸°", tip: "ìƒì²´ 15ë„ ìˆ™ì´ê¸°", guide: "ë°œì„ ëŒ€ê³  ë¬´ê²Œ ì¡°ì ˆ ê°€ëŠ¥", cue: "ì‹œì„  ë°”ë‹¥ 1~2m + íŒ” 95%ë§Œ í´ ê¸´ì¥ ìœ ì§€" },
        { name: "ìŠ¤íƒ ë‹¤ë“œ í‘¸ì‰¬ì—…", set: 4, rep: 15, rest: 75, breath: "ë‚´ë¦´ ë•Œ í¡ê¸° / ë°€ ë•Œ í˜¸ê¸°", target: "ê°€ìŠ´ ì „ì²´", mind: "ì§€ë©´ì„ ê°€ìŠ´ìœ¼ë¡œ ëˆ„ë¥´ê¸°", tip: "ì†ë°”ë‹¥ ì „ì²´ ì ‘ì§€", guide: "ë¬´ë¦ ëŒ€ê³  ìˆ˜í–‰ ê°€ëŠ¥", cue: "ê²¨ë“œë‘ì´ë¥¼ ë¶™ì´ë©° ë°€ì–´ ì˜¬ë¦¬ê¸°" },
        { name: "ë‚´ë¡œìš° ë”¥ìŠ¤", set: 3, rep: 10, rest: 60, breath: "íŒ” í¼ ë•Œ í˜¸ê¸°", target: "ì‚¼ë‘ê·¼", mind: "íŒ” ë’·ë©´ì˜ í˜ìœ¼ë¡œ ì ê¸ˆ", tip: "ìƒì²´ ìˆ˜ì§ ìœ ì§€", guide: "íŒ”ê¿ˆì¹˜ë¥¼ ëª¸ì— ë°€ì°©", cue: "ìƒì²´ ìˆ˜ì§ + íŒ”ê¿ˆì¹˜ ë’¤ë¡œ ëª¨ìœ¼ê¸°" }
      ]},
      2: { day: "í™”ìš”ì¼", type: "pull", title: "ë“± ë‘ê»˜", list: [
        { name: "í’€ì—… (ë°´ë“œ)", set: 4, rep: 8, rest: 120, breath: "ë‹¹ê¸¸ ë•Œ í˜¸ê¸°", target: "ê´‘ë°° ë°”ê¹¥", mind: "íŒ”ê¿ˆì¹˜ë¥¼ ì˜†êµ¬ë¦¬ë¡œ ê½‚ê¸°", tip: "ìˆ„ë” íŒ¨í‚¹ í•„ìˆ˜", guide: "ë°´ë“œ ê°•ë„ ì¡°ì ˆ", cue: "ìˆ„ë”íŒ¨í‚¹ â†’ íŒ”ê¿ˆì¹˜ë¡œ ì˜†êµ¬ë¦¬ ì°ê¸°" },
        { name: "ì¸ë²„í‹°ë“œ ë¡œìš°", set: 4, rep: 12, rest: 90, breath: "ë‹¹ê¸¸ ë•Œ í˜¸ê¸°", target: "ë“± ì¤‘ì•™", mind: "ë‚ ê°œë¼ˆë¥¼ ë’¤ë¡œ ëª¨ìœ¼ê¸°", tip: "ê°€ìŠ´ì„ ë°”ë¡œ ë§ˆì¤‘", guide: "ë°œ ìœ„ì¹˜ë¡œ ë‚œì´ë„ ì¡°ì ˆ", cue: "ëª¸ ì¼ì§ì„  + ë‚ ê°œë¼ˆë¥¼ ë ˆëª¬ ì§œë“¯ ì¡°ì´ê¸°" },
        { name: "ì¹œì—… (ë°´ë“œ)", set: 3, rep: 8, rest: 90, breath: "ì˜¬ë¼ê°ˆ ë•Œ í˜¸ê¸°", target: "ë“± & ì´ë‘", mind: "ê°€ìŠ´ì„ ë´‰ì— ë¶™ì´ê¸°", tip: "ê°€ìŠ´ ë†’ì´ê¹Œì§€ ì˜¬ë¦¬ê¸°", guide: "ì–¸ë”ê·¸ë¦½ ì‚¬ìš©", cue: "ê°€ìŠ´ì„ ë´‰ ìª½ìœ¼ë¡œ ì ‘ì–´ ë„£ê¸°" }
      ]},
      3: { day: "ìˆ˜ìš”ì¼", type: "push", title: "ì¸¡ë©´ ì–´ê¹¨", list: [
        { name: "ì‚¬ì´ë“œ ë ˆì´ì¦ˆ", set: 5, rep: 20, rest: 60, breath: "ì˜¬ë¦´ ë•Œ í˜¸ê¸°", target: "ì¸¡ë©´ ì‚¼ê°ê·¼", mind: "íŒ”ê¿ˆì¹˜ë¥¼ ì–‘ì˜†ìœ¼ë¡œ ë˜ì§", tip: "ë‚ ê°œë¼ˆ ê³ ì •", guide: "ì €ì¤‘ëŸ‰ ê³ ë°˜ë³µ ê¶Œì¥", cue: "ìœ„ê°€ ì•„ë‹ˆë¼ â€˜ë©€ë¦¬ ë˜ì§„ë‹¤â€™" }
      ]},
      4: { day: "ëª©ìš”ì¼", type: "push", title: "ì–´ê¹¨ & ì‚¼ë‘", list: [
        { name: "íŒŒì´í¬ í‘¸ì‰¬ì—…", set: 4, rep: 10, rest: 90, breath: "ë°€ ë•Œ í˜¸ê¸°", target: "ì „ë©´ ì–´ê¹¨", mind: "ì–´ê¹¨ë¡œ ì²œì¥ ë°€ê¸°", tip: "ì—‰ë©ì´ ë†’ì´ ìœ ì§€", guide: "ë¨¸ë¦¬ë¥¼ ì†ë³´ë‹¤ ì•ìœ¼ë¡œ", cue: "ì •ìˆ˜ë¦¬ê°€ ë°”ë‹¥ì— ë‹¿ë“¯ ë‚´ë ¤ê°”ë‹¤ê°€ ë¡œì¼“ì²˜ëŸ¼ ë°€ê¸°" },
        { name: "ë””í´ë¼ì¸ í‘¸ì‰¬ì—…", set: 4, rep: 12, rest: 90, breath: "ë°€ ë•Œ í˜¸ê¸°", target: "ìƒë¶€ ê°€ìŠ´", mind: "ìƒë¶€ ê°€ìŠ´ ì§‘ì¤‘", tip: "ë°œ ìœ„ì¹˜ ë†’ê²Œ", guide: "ê°€ìŠ´ ìœ„ìª½ì— ìê·¹ ì§‘ì¤‘", cue: "ì‡„ê³¨ ì•„ë˜ë¡œ ë°”ë‹¥ì„ ë¯¼ë‹¤" },
        { name: "ì‚¼ë‘ ë”¥ìŠ¤", set: 4, rep: 8, rest: 90, breath: "ë°€ ë•Œ í˜¸ê¸°", target: "ì‚¼ë‘ê·¼", mind: "ì‚¼ë‘ë¡œ í´ì„œ ì ê¸ˆ", tip: "íŒ”ê¿ˆì¹˜ ë’¤ë¡œ ëª¨ìœ¼ê¸°", guide: "ì˜ì ì‚¬ìš© ê°€ëŠ¥", cue: "íŒ”ê¿ˆì¹˜ ë²Œì–´ì§€ì§€ ì•Šê²Œ ë’¤ë¡œ ëª¨ì•„ ì‚¼ë‘ íƒ€ê²©" }
      ]},
      5: { day: "ê¸ˆìš”ì¼", type: "pull", title: "ë“± ë„“ì´", list: [
        { name: "ì™€ì´ë“œ í’€ì—…", set: 4, rep: 6, rest: 120, breath: "ì˜¬ë¼ê°ˆ ë•Œ í˜¸ê¸°", target: "ê´‘ë°° ì™¸ê³½", mind: "ë“±ì„ ë„“ê²Œ í¼ì¹˜ê¸°", tip: "ë„“ì€ ê·¸ë¦½ ì‚¬ìš©", guide: "ìƒë¶€ ê´‘ë°° ìê·¹ ì§‘ì¤‘", cue: "íŒ”ê¿ˆì¹˜ë¥¼ ì•„ë˜ë¡œ ì°ì–´ ê´‘ë°° ì˜†ì„  íƒ€ê²©" },
        { name: "ì¸ë²„í‹°ë“œ ë¡œìš°", set: 4, rep: 12, rest: 90, breath: "ë‹¹ê¸¸ ë•Œ í˜¸ê¸°", target: "ë“± ì•ˆì •ì„±", mind: "ëª¸ì„ ì¼ì§ì„ ìœ¼ë¡œ", tip: "í…œí¬ ì¼ì •í•˜ê²Œ", guide: "ì½”ì–´ ë‹¨ë‹¨íˆ ê³ ì •", cue: "ë‘”ê·¼/ë³µë¶€ ê³ ì • + ë‚ ê°œë¼ˆ ì¡°ì´ê¸°" },
        { name: "ë‚´ë¡œìš° í’€ì—…", set: 3, rep: 8, rest: 90, breath: "ì˜¬ë¼ê°ˆ ë•Œ í˜¸ê¸°", target: "ë“± ì¤‘ì•™", mind: "ë´‰ì— ê°€ìŠ´ í„°ì¹˜", tip: "1ì´ˆê°„ ì •ì§€", guide: "ì¢ì€ ê·¸ë¦½ ì‚¬ìš©", cue: "ê°€ìŠ´ì„ ë´‰ì— ìµœëŒ€í•œ ë¶™ì´ê¸°" }
      ]},
      6: { day: "í† ìš”ì¼", type: "leg", title: "í•˜ì²´ & ì½”ì–´", list: [
        { name: "ìŠ¤ì¿¼íŠ¸", set: 4, rep: 20, rest: 60, breath: "ì˜¬ë¼ì˜¬ ë•Œ í˜¸ê¸°", target: "í—ˆë²…ì§€/ë‘”ê·¼", mind: "ë°œë°”ë‹¥ ì§€ë©´ ë°€ê¸°", tip: "í—ˆë¦¬ ì¤‘ë¦½ ìœ ì§€", guide: "ë’¤ê¿ˆì¹˜ ê³ ì •", cue: "ë‚®ì€ ì˜ìì— ì•‰ì•˜ë‹¤ê°€ ì§€êµ¬ë¥¼ ë¯¼ë‹¤" },
        { name: "ëŸ°ì§€", set: 3, rep: 10, rest: 60, breath: "ì˜¬ë¼ì˜¬ ë•Œ í˜¸ê¸°", target: "ì—‰ë©ì´", mind: "ë’¤ê¿ˆì¹˜ì— í˜ ì „ë‹¬", tip: "ìƒì²´ ì‚´ì§ ìˆ™ì´ê¸°", guide: "ë¬´ë¦ ì•ˆì •ì„± ìœ ì˜", cue: "ì•ë°œ ë’¤ê¿ˆì¹˜ë¡œ ê°•ë ¥í•˜ê²Œ ë°€ê¸°" },
        { name: "í”Œë­í¬", set: 3, rep: 60, rest: 60, breath: "ì¼ì •í•˜ê²Œ ìœ ì§€", target: "ì½”ì–´", mind: "ë°°ë¥¼ ì•ˆìœ¼ë¡œ ë‹¹ê¸°ê¸°", tip: "ì—‰ë©ì´ ìˆ˜ì¶•", guide: "ì¼ì§ì„  ìœ ì§€", cue: "ê°•ì²  íŒìì²˜ëŸ¼ ë²„í‹°ê¸°" }
      ]},
      0: { day: "ì¼ìš”ì¼", type: "rest", title: "íšŒë³µ", list: [
        { name: "ìŠ¤íŠ¸ë ˆì¹­", set: 1, rep: 15, rest: 0, breath: "ê¹Šê³  ê¸¸ê²Œ", target: "ì „ì‹  ì´ì™„", mind: "ê·¼ìœ¡ ì´ì™„ ëŠë¼ê¸°", tip: "ì–´ê¹¨/ê´‘ë°° ì§‘ì¤‘", guide: "ì¶©ë¶„í•œ ìˆ˜ë©´ ê¶Œì¥", cue: "ë¶€ë“œëŸ½ê²Œ ê¸¸ê²Œ, ê°•ë„ë³´ë‹¤ í˜¸í¡" }
      ]}
    };

    /* ---------- STORAGE KEYS ---------- */
    const KEY_LOGS = 'dk_os_v113_logs';
    const KEY_SETS = 'dk_os_v113_sets';
    const KEY_REPS = 'dk_os_v113_reps';
    const KEY_PROGRESS_BY_DATE = 'dk_os_v113_progress_by_date';
    const KEY_SPLASH = 'dk_os_v113_splash_shown';
    const KEY_SUMMARY_SHOWN = 'dk_os_v113_summary_shown';

    /* ---------- LOAD ---------- */
    function safeParse(raw, fallback){ try { return raw ? JSON.parse(raw) : fallback; } catch(e){ return fallback; } }
    let logs = safeParse(localStorage.getItem(KEY_LOGS), []);
    let customSets = safeParse(localStorage.getItem(KEY_SETS), {});
    let customReps = safeParse(localStorage.getItem(KEY_REPS), {});
    let progressByDate = safeParse(localStorage.getItem(KEY_PROGRESS_BY_DATE), {});

    /* ---------- STATE ---------- */
    let timerInt = null;
    let totalSec = 0;
    let currentDayIdx = new Date().getDay();
    let currentYear = new Date().getFullYear();
    let currentMonth = new Date().getMonth();
    let selectedDate = new Date().toISOString().split('T')[0];
    let restRemaining = 0;
    let currentSlideIndex = 0;

    /* ---------- UTILS ---------- */
    function haptic(ms=18){ if(navigator.vibrate) navigator.vibrate(ms); }
    function nowISO(){ return new Date().toISOString(); }
    function todayStr(){ return new Date().toISOString().split('T')[0]; }
    function clamp(n,min,max){ return Math.max(min, Math.min(max, n)); }
    function exId(dayIdx, exIdx){ return `${dayIdx}-${exIdx}`; }

    /* ---------- SPLASH ---------- */
    function initIntro(){
      const shown = localStorage.getItem(KEY_SPLASH) === '1';
      const splash = document.getElementById('splash-screen');
      if(shown){ splash.style.display = 'none'; return; }
      setTimeout(() => {
        splash.style.opacity = '0';
        splash.style.transform = 'scale(1.08)';
        setTimeout(()=> splash.style.display='none', 1000);
        localStorage.setItem(KEY_SPLASH, '1');
      }, 1600);
    }

    /* ---------- TOAST ---------- */
    let toastTimer=null;
    function toast(msg){
      const el = document.getElementById('toast');
      el.textContent = msg;
      el.classList.add('show');
      if(toastTimer) clearTimeout(toastTimer);
      toastTimer = setTimeout(()=> el.classList.remove('show'), 1600);
    }

    /* ---------- DOCK: NEVER COVER CONTENT ---------- */
    function syncDockSpace(){
      const sheet = document.getElementById('dockSheet');
      if(!sheet) return;
      const h = sheet.getBoundingClientRect().height + 26; // padding ì—¬ìœ 
      document.documentElement.style.setProperty('--dock-space', h + 'px');
    }

    /* ---------- DOCK AUTO HIDE ---------- */
    let dockTimer = null;
    let lastScrollY = 0;

    function showDock(){
      const wrap = document.getElementById('dockWrap');
      wrap.classList.remove('hide');
      if(dockTimer) clearTimeout(dockTimer);
      dockTimer = setTimeout(()=> wrap.classList.add('hide'), 2600);
      syncDockSpace();
    }

    function hideDock(){
      document.getElementById('dockWrap').classList.add('hide');
    }

    window.addEventListener('scroll', ()=>{
      const y = window.scrollY;
      if(y > lastScrollY) hideDock();
      else showDock();
      lastScrollY = y;
    }, {passive:true});

    ['touchstart','mousemove'].forEach(evt=>{
      window.addEventListener(evt, showDock, {passive:true});
    });

    /* ---------- BOTTOM SHEET SWIPE ---------- */
    let sheetExpanded = false;
    let dragStartY = null;
    let dragDelta = 0;

    function setSheet(expanded){
      sheetExpanded = expanded;
      const sheet = document.getElementById('dockSheet');
      sheet.classList.toggle('expanded', expanded);
      syncDockSpace();
      showDock();
    }

    function bindSheetSwipe(){
      const grab = document.getElementById('dockGrab');
      const sheet = document.getElementById('dockSheet');

      const start = (y) => { dragStartY = y; dragDelta = 0; };
      const move = (y) => {
        if(dragStartY === null) return;
        dragDelta = y - dragStartY;
      };
      const end = () => {
        if(dragStartY === null) return;
        if(dragDelta < -22) setSheet(true);   // ìœ„ë¡œ
        if(dragDelta > 22) setSheet(false);   // ì•„ë˜ë¡œ
        dragStartY = null;
      };

      grab.addEventListener('touchstart', (e)=> start(e.touches[0].clientY), {passive:true});
      grab.addEventListener('touchmove', (e)=> move(e.touches[0].clientY), {passive:true});
      grab.addEventListener('touchend', end);

      // í´ë¦­ìœ¼ë¡œ í† ê¸€ë„ ê°€ëŠ¥
      grab.addEventListener('click', ()=> setSheet(!sheetExpanded));

      // resize ëŒ€ì‘
      window.addEventListener('resize', ()=> syncDockSpace());
      window.addEventListener('orientationchange', ()=> setTimeout(syncDockSpace, 120));
      setTimeout(syncDockSpace, 120);
    }

    /* ---------- SUMMARY MODAL ---------- */
    function openSummary(stats){
      document.getElementById('sum-sets').textContent = stats.sets;
      document.getElementById('sum-ex').textContent = stats.exercises;
      document.getElementById('sum-msg').textContent = stats.msg;
      document.getElementById('summary-modal').classList.add('show');
      hideDock();
    }
    function closeSummary(){
      document.getElementById('summary-modal').classList.remove('show');
      showDock();
    }

    /* ---------- TABS ---------- */
    function showTab(name, btn){
      document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
      document.getElementById(`tab-${name}`).classList.add('active');
      document.querySelectorAll('.nav-item').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');

      if(name === 'stats') renderStats();
      if(name === 'history') renderCalendar();

      window.scrollTo({ top: 0, behavior: 'smooth' });

      // âœ… sessionì—ì„œë§Œ ìš”ì¼ ë„¤ë¹„ ìë™ í‘œì‹œ
      if(name === 'session') revealDayNav();
      else document.getElementById('day-nav-wrap').classList.add('hide');

      showDock();
    }

    /* ---------- DAY NAV (AUTO SHOW/HIDE) ---------- */
    let dayNavHideTimer=null;
    function revealDayNav(){
      const wrap = document.getElementById('day-nav-wrap');
      wrap.classList.remove('hide');
      if(dayNavHideTimer) clearTimeout(dayNavHideTimer);
      dayNavHideTimer = setTimeout(()=> wrap.classList.add('hide'), 2600);
    }

    function updateDayNav(){
      const nav = document.getElementById('day-nav');
      nav.innerHTML = '';
      ['ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† ','ì¼'].forEach((d, i) => {
        const dm = (i === 6) ? 0 : i + 1;
        const b = document.createElement('button');
        b.className = `day-chip ${dm === currentDayIdx ? 'active' : ''}`;
        b.innerText = d;
        b.onclick = () => changeDay(dm);
        nav.appendChild(b);
      });
    }

    /* ---------- DATE-BASED PROGRESS ---------- */
    function getProgressArr(date, exerciseId, setTotal){
      if(!progressByDate[date]) progressByDate[date] = {};
      let arr = progressByDate[date][exerciseId];
      if(!Array.isArray(arr)){
        arr = new Array(setTotal).fill(false);
        progressByDate[date][exerciseId] = arr;
        localStorage.setItem(KEY_PROGRESS_BY_DATE, JSON.stringify(progressByDate));
        return arr;
      }
      if(arr.length !== setTotal){
        const next = new Array(setTotal).fill(false);
        for(let i=0;i<Math.min(arr.length,setTotal);i++) next[i]=!!arr[i];
        progressByDate[date][exerciseId] = next;
        localStorage.setItem(KEY_PROGRESS_BY_DATE, JSON.stringify(progressByDate));
        return next;
      }
      return arr;
    }

    function computeProgressForDay(date, dayIdx){
      let total = 0, done = 0;
      workoutData[dayIdx].list.forEach((w, idx) => {
        const id = exId(dayIdx, idx);
        const setTotal = customSets[id] || w.set;
        total += setTotal;
        const arr = getProgressArr(date, id, setTotal);
        done += arr.filter(Boolean).length;
      });
      return { total, done, pct: Math.round((done/total)*100) || 0 };
    }

    function updateProgressUI(){
      const p = computeProgressForDay(todayStr(), currentDayIdx);
      document.getElementById('progress-bar').style.width = p.pct + '%';
      document.getElementById('progress-percent').innerText = p.pct + '%';
      if(p.pct === 100) maybeShowSummary();
    }

    function maybeShowSummary(){
      const date = todayStr();
      const key = `${date}|${currentDayIdx}`;
      if(localStorage.getItem(KEY_SUMMARY_SHOWN) === key) return;

      const stats = getTodaySummaryStats();
      localStorage.setItem(KEY_SUMMARY_SHOWN, key);
      openSummary(stats);
      haptic(30);
    }

    function getTodaySummaryStats(){
      const date = todayStr();
      const data = workoutData[currentDayIdx];
      let setsDone = 0;
      let exDone = 0;
      data.list.forEach((w, idx)=>{
        const id = exId(currentDayIdx, idx);
        const setTotal = customSets[id] || w.set;
        const arr = getProgressArr(date, id, setTotal);
        const done = arr.filter(Boolean).length;
        setsDone += done;
        if(done === setTotal) exDone++;
      });
      const msgPool = [
        "ì˜¤ëŠ˜ë„ ì™„ë²½í–ˆë‹¤. ë‚´ì¼ì€ ë” ê°•í•´ì§„ë‹¤.",
        "í¼ì´ ì˜¬ë¼ì™”ë‹¤. ë‹¤ìŒ ì£¼ëŠ” ê¸°ë¡ ê°±ì‹ .",
        "ì§‘ì¤‘ë ¥ì´ ë¯¸ì³¤ë‹¤. ì»¨ë””ì…˜ ìµœê³ .",
        "ê·œì¹™ì€ ë°°ì‹ í•˜ì§€ ì•ŠëŠ”ë‹¤. ê³„ì† ê°„ë‹¤.",
        "ì˜¤ëŠ˜ì€ ì„±ê³µ. ë‹¤ìŒì€ ì§„ì§œ ë ˆë²¨ì—…."
      ];
      return {
        sets: setsDone,
        exercises: exDone,
        msg: msgPool[Math.floor(Math.random()*msgPool.length)]
      };
    }

    /* ---------- CHANGE DAY ---------- */
    function changeDay(d){
      currentDayIdx = d;
      currentSlideIndex = 0;

      const data = workoutData[d];
      document.getElementById('view-day').innerText = data.day;
      document.getElementById('view-title').innerText = data.title;

      const cueMap = {
        push: "í‘¸ì‰¬ ë°ì´ â€” í…œí¬ ì œì–´ & ì½”ì–´ ê³ ì •",
        pull: "í’€ ë°ì´ â€” ìˆ„ë” íŒ¨í‚¹ & ê´‘ë°° ìˆ˜ì¶•",
        leg:  "í•˜ì²´ ë°ì´ â€” ë°œ ì „ì²´ë¡œ ë°€ê¸°",
        rest: "íšŒë³µ â€” í˜¸í¡ & ë¦¬ì…‹"
      };
      document.getElementById('view-subcue').innerText = cueMap[data.type] || "í›ˆë ¨ ëª¨ë“œ";

      renderCarousel();
      updateProgressUI();

      updateDayNav();
      revealDayNav();
      showDock();
    }

    /* ---------- CAROUSEL ---------- */
    function renderCarousel(){
      const date = todayStr();
      const data = workoutData[currentDayIdx];
      const carousel = document.getElementById('session-carousel');
      carousel.innerHTML = '';

      data.list.forEach((w, idx) => {
        const id = exId(currentDayIdx, idx);
        const setTotal = customSets[id] || w.set;
        const repTotal = customReps[id] || w.rep;
        const doneArr = getProgressArr(date, id, setTotal);
        const doneCount = doneArr.filter(Boolean).length;

        const slide = document.createElement('div');
        slide.className = 'slide';
        slide.setAttribute('data-slide', idx);

        slide.innerHTML = `
          <div class="glass slideCard p-6 md:p-7">
            <div>
              <div class="flex items-start justify-between gap-3">
                <div class="min-w-0">
                  <h3 class="text-3xl md:text-4xl font-black italic text-white tracking-tight truncate">${w.name}</h3>
                  <div class="mt-3 flex items-center gap-2 flex-wrap">
                    <span class="pill cyan">${w.target}</span>
                    <span class="pill">${workoutData[currentDayIdx].type.toUpperCase()}</span>
                    <span class="pill">íœ´ì‹ ${w.rest}s</span>
                    <span class="pill">ì§„í–‰ ${doneCount}/${setTotal}</span>
                  </div>
                </div>
                <button onclick="resetExercise('${id}')" class="pill" title="ì´ ìš´ë™(ì˜¤ëŠ˜) ì´ˆê¸°í™”">
                  <i class="fa-solid fa-rotate-left"></i>
                </button>
              </div>

              <div class="mt-5 grid md:grid-cols-2 gap-4">
                <div class="space-y-3">
                  <div class="glass rounded-2xl p-4 border-white/5">
                    <p class="text-[10px] font-black tracking-[0.18em] uppercase text-white/45 mb-2">í•µì‹¬ í</p>
                    <p class="text-base md:text-lg font-black text-white/80 leading-relaxed">${w.cue || w.tip || ''}</p>
                  </div>

                  <div class="grid grid-cols-2 gap-3">
                    <div class="bg-white/[0.02] p-4 rounded-2xl border border-white/5">
                      <p class="text-[10px] font-black tracking-[0.18em] uppercase text-indigo-300 mb-2">í˜¸í¡</p>
                      <p class="text-[13px] font-bold text-white/70">${w.breath}</p>
                    </div>
                    <div class="bg-white/[0.02] p-4 rounded-2xl border border-white/5">
                      <p class="text-[10px] font-black tracking-[0.18em] uppercase text-indigo-300 mb-2">ì˜ì‹</p>
                      <p class="text-[13px] font-bold text-white/70">${w.mind}</p>
                    </div>
                    <div class="bg-cyan-400/[0.04] p-4 rounded-2xl border border-cyan-400/10 col-span-2">
                      <p class="text-[10px] font-black tracking-[0.18em] uppercase text-cyan-300 mb-2">ì—˜ë¦¬íŠ¸ ê°€ì´ë“œ</p>
                      <p class="text-[13px] font-bold text-white/75">${w.tip} Â· <span class="text-white/45">${w.guide}</span></p>
                    </div>
                  </div>

                  <p class="text-[11px] font-black text-white/35">* ì¢Œìš°ë¡œ ë„˜ê²¨ ë‹¤ìŒ/ì´ì „ ìš´ë™ìœ¼ë¡œ ì´ë™</p>
                </div>

                <div class="rightPanel space-y-3">
                  <div class="glass rounded-2xl p-4 border-white/5">
                    <p class="text-[10px] font-black tracking-[0.18em] uppercase text-white/45">ì„¸íŠ¸/íšŸìˆ˜ ì„¤ì •</p>
                    <p class="text-[11px] mt-2 font-bold text-white/45">* ì„¸íŠ¸ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì²´í¬í•©ë‹ˆë‹¤</p>
                  </div>

                  <div class="stepper">
                    <div>
                      <div class="stepperLabel">SET</div>
                      <div class="stepperValue">${setTotal}</div>
                    </div>
                    <div class="flex items-center gap-2">
                      <button class="stepperBtn" onclick="adjust('set','${id}',-1)"><i class="fa-solid fa-minus"></i></button>
                      <button class="stepperBtn" onclick="adjust('set','${id}',1)"><i class="fa-solid fa-plus"></i></button>
                    </div>
                  </div>

                  <div class="stepper">
                    <div>
                      <div class="stepperLabel">REP</div>
                      <div class="stepperValue">${repTotal}</div>
                    </div>
                    <div class="flex items-center gap-2">
                      <button class="stepperBtn" onclick="adjust('rep','${id}',-1)"><i class="fa-solid fa-minus"></i></button>
                      <button class="stepperBtn" onclick="adjust('rep','${id}',1)"><i class="fa-solid fa-plus"></i></button>
                    </div>
                  </div>

                  <button class="bigBtn" onclick="resetSetRepToDefault('${id}')">
                    <i class="fa-solid fa-wand-magic-sparkles"></i>
                    ì„¸íŠ¸/íšŸìˆ˜ ê¸°ë³¸ê°’
                  </button>

                  <div class="grid grid-cols-2 gap-3">
                    ${Array.from({length:setTotal}).map((_, s)=>{
                      const done = !!doneArr[s];
                      return `<button class="setBtn ${done?'done':''}" data-date="${date}" data-ex="${id}" data-set="${s}">
                        ${done ? `<i class='fa-solid fa-check'></i>` : ''}
                        ${s+1} ì„¸íŠ¸
                      </button>`;
                    }).join('')}
                  </div>
                </div>
              </div>
            </div>

            <div class="mt-5 flex items-center justify-between gap-2 flex-wrap">
              <div class="flex items-center gap-2">
                <span class="pill cyan">${idx+1} / ${data.list.length}</span>
                <span class="pill">${w.name}</span>
              </div>
              <div class="flex items-center gap-2">
                <button class="pill" onclick="carouselPrev()"><i class="fa-solid fa-chevron-left"></i> ì´ì „</button>
                <button class="pill cyan" onclick="carouselNext()">ë‹¤ìŒ <i class="fa-solid fa-chevron-right"></i></button>
              </div>
            </div>
          </div>
        `;

        carousel.appendChild(slide);
      });

      bindSetButtons();
      bindCarouselEvents();
      updateSlideHUD();
      requestAnimationFrame(()=> scrollToSlide(0,false));
    }

    function bindCarouselEvents(){
      const carousel = document.getElementById('session-carousel');
      carousel.onscroll = () => {
        const slides = Array.from(carousel.children);
        if(!slides.length) return;
        const slideWidth = slides[0].getBoundingClientRect().width + 18;
        const idx = Math.round(carousel.scrollLeft / slideWidth);
        if(idx !== currentSlideIndex){
          currentSlideIndex = clamp(idx, 0, slides.length-1);
          updateSlideHUD();
        }
      };
    }

    function updateSlideHUD(){
      const data = workoutData[currentDayIdx];
      const total = data.list.length;
      const idx = clamp(currentSlideIndex, 0, total-1);
      document.getElementById('slide-indicator').innerText = `${idx+1} / ${total}`;
      document.getElementById('slide-name').innerText = data.list[idx]?.name || 'ìš´ë™';

      const carousel = document.getElementById('session-carousel');
      Array.from(carousel.children).forEach((el, i)=>{
        el.classList.toggle('focus', i === idx);
        el.classList.toggle('peek', i !== idx);
      });
    }

    function scrollToSlide(idx, smooth=true){
      const carousel = document.getElementById('session-carousel');
      const slides = Array.from(carousel.children);
      if(!slides.length) return;
      idx = clamp(idx, 0, slides.length-1);
      const slideWidth = slides[0].getBoundingClientRect().width + 18;
      carousel.scrollTo({ left: slideWidth * idx, behavior: smooth ? 'smooth' : 'auto' });
    }

    function carouselNext(){
      const data = workoutData[currentDayIdx];
      currentSlideIndex = clamp(currentSlideIndex + 1, 0, data.list.length-1);
      scrollToSlide(currentSlideIndex, true);
      updateSlideHUD();
      haptic(10);
    }

    function carouselPrev(){
      const data = workoutData[currentDayIdx];
      currentSlideIndex = clamp(currentSlideIndex - 1, 0, data.list.length-1);
      scrollToSlide(currentSlideIndex, true);
      updateSlideHUD();
      haptic(10);
    }

    function bindSetButtons(){
      const buttons = document.querySelectorAll('.setBtn[data-ex]');
      buttons.forEach(btn => {
        const date = btn.getAttribute('data-date');
        const ex = btn.getAttribute('data-ex');
        const setIndex = Number(btn.getAttribute('data-set'));

        const clone = btn.cloneNode(true);
        btn.replaceWith(clone);
        clone.addEventListener('click', () => toggleSetComplete(date, ex, setIndex));
      });
    }

    function toggleSetComplete(date, exerciseId, setIndex){
      const [dayIdx, exIdx] = exerciseId.split('-').map(Number);
      const w = workoutData[dayIdx]?.list?.[exIdx];
      if(!w) return;

      const setTotal = customSets[exerciseId] || w.set;
      const repTotal = customReps[exerciseId] || w.rep;

      const doneArr = getProgressArr(date, exerciseId, setTotal);
      doneArr[setIndex] = !doneArr[setIndex];
      progressByDate[date][exerciseId] = doneArr;
      localStorage.setItem(KEY_PROGRESS_BY_DATE, JSON.stringify(progressByDate));

      const setNo = setIndex + 1;

      if(doneArr[setIndex]){
        if(w.rest > 0) startTimer(w.rest);
        if(setNo === setTotal){
          setTimeout(()=> carouselNext(), 250);
        }
        haptic(16);
      }else{
        haptic(12);
      }

      updateProgressUI();
      renderCarousel();
    }

    function adjust(type, key, val){
      const [d, idx] = key.split('-').map(Number);
      const w = workoutData[d]?.list?.[idx];
      if(!w) return;

      if(type === 'set'){
        const cur = customSets[key] || w.set;
        const next = clamp(cur + val, 1, 12);
        customSets[key] = next;
        localStorage.setItem(KEY_SETS, JSON.stringify(customSets));
        getProgressArr(todayStr(), key, next);
      }else{
        const cur = customReps[key] || w.rep;
        customReps[key] = clamp(cur + val, 1, 100);
        localStorage.setItem(KEY_REPS, JSON.stringify(customReps));
      }

      renderCarousel();
      updateProgressUI();
      toast('ì„¤ì • ì €ì¥ë¨');
    }

    function resetSetRepToDefault(exerciseId){
      const [d, idx] = exerciseId.split('-').map(Number);
      const w = workoutData[d]?.list?.[idx];
      if(!w) return;

      if(customSets[exerciseId] !== undefined) delete customSets[exerciseId];
      if(customReps[exerciseId] !== undefined) delete customReps[exerciseId];
      localStorage.setItem(KEY_SETS, JSON.stringify(customSets));
      localStorage.setItem(KEY_REPS, JSON.stringify(customReps));

      getProgressArr(todayStr(), exerciseId, w.set);
      renderCarousel();
      updateProgressUI();
      toast('ê¸°ë³¸ê°’ìœ¼ë¡œ ë³µì›');
      haptic(18);
    }

    function resetToday(){
      if(!confirm('ì˜¤ëŠ˜ ì§„í–‰/ê¸°ë¡ì„ ëª¨ë‘ ì´ˆê¸°í™”í• ê¹Œìš”?')) return;
      const date = todayStr();
      if(progressByDate[date]) delete progressByDate[date];
      localStorage.setItem(KEY_PROGRESS_BY_DATE, JSON.stringify(progressByDate));
      toast('ì˜¤ëŠ˜ ì´ˆê¸°í™” ì™„ë£Œ');
      haptic(25);
      renderCarousel();
      updateProgressUI();
    }

    /* --- TIMER (ê°„ì†Œí™”) --- */
    function startTimer(sec){
      // ì›ë³¸ ìœ ì§€í•˜ê³  ì‹¶ìœ¼ë©´ ì›ë˜ Timer Modal ì½”ë“œ ë¶™ì´ë©´ ë¨
      // ì—¬ê¸°ì„  ìµœì†Œ êµ¬í˜„ ìœ ì§€
    }

    /* --- Calendar/Stats/Backup/ResetAllì€ ì›ë³¸ ê·¸ëŒ€ë¡œ ì‚¬ìš© ê°€ëŠ¥ --- */
    function renderCalendar(){ /* ì›ë³¸ ê·¸ëŒ€ë¡œ */ }
    function renderStats(){ /* ì›ë³¸ ê·¸ëŒ€ë¡œ */ }
    function backupJSON(){ /* ì›ë³¸ ê·¸ëŒ€ë¡œ */ }
    function resetAll(){ /* ì›ë³¸ ê·¸ëŒ€ë¡œ */ }
    function resetSelectedDate(){ /* ì›ë³¸ ê·¸ëŒ€ë¡œ */ }

    /* ---------- INIT ---------- */
    window.onload = () => {
      initIntro();

      updateDayNav();                 // âœ… ìš”ì¼ ë„¤ë¹„ ë Œë”
      changeDay(new Date().getDay()); // âœ… ì˜¤ëŠ˜ ìš”ì¼ í‘œì‹œ
      revealDayNav();                 // âœ… ì²« í™”ë©´ì—ì„œ ë³´ì´ê²Œ

      bindSheetSwipe();               // âœ… sheet swipe enable
      showDock();                     // âœ… dock show
      syncDockSpace();                // âœ… body padding sync

      const start = Date.now();
      setInterval(()=> {
        totalSec = Math.floor((Date.now() - start)/1000);
        const m = Math.floor(totalSec/60).toString().padStart(2,'0');
        const s = (totalSec%60).toString().padStart(2,'0');
        document.getElementById('stopwatch').innerText = `${m}:${s}`;
      }, 1000);
    };
  </script>
</body>
</html>
